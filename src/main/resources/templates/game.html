<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Let's Play</title>
</head>
<body>
	<script type="text/javascript">
			var yourTurn = [[${turn}]] || false;
			
			// if it's not your tourn check move 
			setTimeout(check, 2000);
			function check() {
				if(!yourTurn){
					var ajax = new XMLHttpRequest();
					ajax.onreadystatechange = processCheck;
			
					ajax.open("GET", "/api/game/check/[[${id}]]/[[${player}]]", true);
					ajax.send(null);
				}
				else{
				}
			}
			function processCheck() {
				if (this.readyState == 4) {
					if(this.status == 304)
						setTimeout(check, 2000);
					else if(this.status == 200){
						var val = JSON.parse(this.responseText);
						document.getElementById(val.last).innerHTML="o";
						yourTurn = true;
					}
					else{
						alert("Something terrible must have happened!");
					}
				}		
			}
			function send(td) {
				if(yourTurn){
					yourTurn = false;
					var id = td.getAttribute("id");
					var ajax = new XMLHttpRequest();
					ajax.onreadystatechange = processResult;
			
					ajax.open("PUT", "/api/game/[[${id}]]/[[${player}]]", true);
					ajax.setRequestHeader("Content-type", "application/json");
					ajax.send(JSON.stringify({"cell_id":id}));
				}
				else{
					alert("It's not your tourn");
				}
			}
			function processResult() {
				if (this.readyState == 4) {
					if(this.status == 304){
						alert("Move is not accepted, please, try again");
						yourTurn = true;
					}
					else if(this.status == 200){
						var val = JSON.parse(this.responseText);
						document.getElementById(val.cell).innerHTML="x";
						setTimeout(check, 2000);
					}
					else{
						alert("Something terrible must have happened!");
					}
				}		
			}
		</script>
	<p>GameId: [[${id}]]</p>
	<table border="1">
		<tr>
			<td colspan="3">Player: [[${player}]]</td>
		</tr>
		<tr>
			<td id="0" style="width: 30px; height: 30px" onclick="send(this)">[[${table[0]}]]</td>
			<td id="1" style="width: 30px; height: 30px" onclick="send(this)">[[${table[1]}]]</td>
			<td id="2" style="width: 30px; height: 30px" onclick="send(this)">[[${table[2]}]]</td>
		</tr>
		<tr>
			<td id="3" style="width: 30px; height: 30px" onclick="send(this)">[[${table[3]}]]</td>
			<td id="4" style="width: 30px; height: 30px" onclick="send(this)">[[${table[4]}]]</td>
			<td id="5" style="width: 30px; height: 30px" onclick="send(this)">[[${table[5]}]]</td>
		</tr>
		<tr>
			<td id="6" style="width: 30px; height: 30px" onclick="send(this)">[[${table[6]}]]</td>
			<td id="7" style="width: 30px; height: 30px" onclick="send(this)">[[${table[7]}]]</td>
			<td id="8" style="width: 30px; height: 30px" onclick="send(this)">[[${table[8]}]]</td>
		</tr>
		<tr>
			<td colspan="3">Player: [[${opponent}]]</td>
		</tr>
	</table>
</body>
</html>
